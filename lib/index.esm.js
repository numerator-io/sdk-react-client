import e from"axios";import{jsx as r}from"react/jsx-runtime";import{createContext as t,useState as o,useContext as n}from"react";function a(e,r,t,o){return new(t||(t=Promise))((function(n,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function u(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,u)}l((o=o.apply(e,r||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const i=e=>null===e||"object"!=typeof e?e:Array.isArray(e)?e.map(i):Object.keys(e).reduce(((r,t)=>(r[t.replace(/_([a-z])/g,((e,r)=>r.toUpperCase()))]=i(e[t]),r)),{});class u{constructor(e){this.apiKey=e.apiKey,this.baseUrl=e.baseUrl||"https://service-platform.dev.numerator.io"}request(r){var t,o;return a(this,void 0,void 0,(function*(){const n=`${this.baseUrl}/${r.endpoint}`,a={"Content-Type":"application/json",[u.API_KEY_HEADER]:this.apiKey},l=Object.assign({url:n,headers:a},r);try{const r=yield e.request(l);return{data:i(r.data),error:void 0}}catch(e){const r=e.response;if(r){return{data:void 0,error:{message:(null===(t=r.data)||void 0===t?void 0:t.message)||"Unknown Error",errorCode:(null===(o=r.data)||void 0===o?void 0:o.error_code)||"unknown_error",errorStatus:r.status}}}return console.warn("AxiosError:",e.message),{data:void 0,error:{message:"Unknown Error",error_code:"unknown_error",http_status:500}}}}))}}u.API_KEY_HEADER="X-NUM-API-KEY";const l="api/sdk/feature-flag",s=`${l}/listing`,c=`${l}/detail-by-key`,d=`${l}/by-key`;class v{constructor(e){this.handleFeatureFlagNotFound=()=>Promise.reject({message:"Feature Flag not found",errorCode:"FEATURE_FLAG_NOT_FOUND",errorStatus:404}),this.apiClient=new u(e)}featureFlagConfigListing(e){return a(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:s,data:e||{}});return r.error?(console.warn("Error fetching featureFlagConfigListing due to: [",r.error,"]"),Promise.reject(r.error)):r.data||{count:0,data:[]}}catch(e){return console.warn("Error fetching featureFlagConfigListing due to: [",e,"]"),Promise.reject(e)}}))}allFeatureFlagsConfig(){return a(this,void 0,void 0,(function*(){try{let e=0;const r=200;let t,o=[];do{t=yield this.featureFlagConfigListing({page:e++,size:r}),o=o.concat(t.data)}while(o.length<t.count);return o}catch(e){throw console.error("Error fetching allFeatureFlagsConfig due to:",e),e}}))}featureFlagConfigByKey(e){return a(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"GET",endpoint:c,params:{key:e}});return r.error?(console.warn("Error fetching featureFlagConfigByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagConfigByKey due to: [",e,"]"),Promise.reject(e)}}))}getFeatureFlagByKey(e){return a(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:d,data:e});return r.error?(console.warn("Error fetching featureFlagValueByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagValueByKey due to: [",e,"]"),Promise.reject(e)}}))}}const g=t(void 0),f=({children:e,configClient:t,defaultContext:n})=>{const i=(e=>new v({apiKey:e.apiKey,baseUrl:e.baseUrl||"https://service-platform.dev.numerator.io"}))(t),[u,l]=o({}),s=(e,r)=>a(void 0,void 0,void 0,(function*(){return yield i.getFeatureFlagByKey({key:e,context:r})})),c=(e,r,t=void 0,o=!0)=>a(void 0,void 0,void 0,(function*(){var a;try{const r=null!=t?t:o?n:{},i=yield s(e,r);return{key:e,value:null!==(a=i.value.booleanValue)&&void 0!==a&&a,reason:{}}}catch(t){return console.warn("Error fetching flag boolean variation:",t),{key:e,value:r,reason:{}}}})),d=(e,r,t=void 0,o=!0)=>a(void 0,void 0,void 0,(function*(){var a,i;try{const r=null!=t?t:o?n:{},u=yield s(e,r);return{key:e,value:null!==(i=null!==(a=u.value.longValue)&&void 0!==a?a:u.value.doubleValue)&&void 0!==i?i:0,reason:{}}}catch(t){return console.warn("Error fetching flag number variation:",t),{key:e,value:r,reason:{}}}})),f=(e,r,t=void 0,o=!0)=>a(void 0,void 0,void 0,(function*(){var a;try{const r=null!=t?t:o?n:{},i=yield s(e,r);return{key:e,value:null!==(a=i.value.stringValue)&&void 0!==a?a:"",reason:{}}}catch(t){return console.warn("Error fetching flag string variation:",t),{key:e,value:r,reason:{}}}})),y={allFlags:()=>a(void 0,void 0,void 0,(function*(){return yield i.allFeatureFlagsConfig()})),booleanFlagVariation:c,numberFlagVariation:d,stringFlagVariation:f,initFeatureFlag:(e,r)=>{u[e]=r,l(u)},getFeatureFlag:(e,r=void 0,t=!0)=>a(void 0,void 0,void 0,(function*(){const o=u[e];switch(typeof o){case"boolean":return(yield c(e,o,r,t)).value;case"number":return(yield d(e,o,r,t)).value;case"string":return(yield f(e,o,r,t)).value}}))};return r(g.Provider,{value:y,children:e})},y=()=>{const e=n(g);if(!e)throw new Error("NumeratorClient must be used within a NumeratorProvider");return e};var h,F;!function(e){e.ON="ON",e.OFF="OFF"}(h||(h={})),function(e){e.BOOLEAN="BOOLEAN",e.STRING="STRING",e.LONG="LONG",e.DOUBLE="DOUBLE"}(F||(F={}));export{h as FlagStatusEnum,F as FlagValueTypeEnum,v as NumeratorClient,f as NumeratorProvider,y as useNumeratorContext};
//# sourceMappingURL=index.esm.js.map
