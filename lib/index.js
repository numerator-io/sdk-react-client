!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("axios"),require("react/jsx-runtime"),require("react")):"function"==typeof define&&define.amd?define(["exports","axios","react/jsx-runtime","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).Numerator={},e.axios,e.jsxRuntime,e.react)}(this,(function(e,r,t,o){"use strict";function n(e,r,t,o){return new(t||(t=Promise))((function(n,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function u(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,u)}l((o=o.apply(e,r||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const a=e=>null===e||"object"!=typeof e?e:Array.isArray(e)?e.map(a):Object.keys(e).reduce(((r,t)=>(r[t.replace(/_([a-z])/g,((e,r)=>r.toUpperCase()))]=a(e[t]),r)),{});class i{constructor(e){this.apiKey=e.apiKey,this.baseUrl=e.baseUrl||"https://service-platform.dev.numerator.io"}request(e){var t,o;return n(this,void 0,void 0,(function*(){const n=`${this.baseUrl}/${e.endpoint}`,u={"Content-Type":"application/json",[i.API_KEY_HEADER]:this.apiKey},l=Object.assign({url:n,headers:u},e);try{const e=yield r.request(l);return{data:a(e.data),error:void 0}}catch(e){const r=e.response;if(r){return{data:void 0,error:{message:(null===(t=r.data)||void 0===t?void 0:t.message)||"Unknown Error",errorCode:(null===(o=r.data)||void 0===o?void 0:o.error_code)||"unknown_error",errorStatus:r.status}}}return console.warn("AxiosError:",e.message),{data:void 0,error:{message:"Unknown Error",error_code:"unknown_error",http_status:500}}}}))}}i.API_KEY_HEADER="X-NUM-API-KEY";const u="api/sdk/feature-flag",l=`${u}/listing`,s=`${u}/detail-by-key`,d=`${u}/by-key`;class c{constructor(e){this.handleFeatureFlagNotFound=()=>Promise.reject({message:"Feature Flag not found",errorCode:"FEATURE_FLAG_NOT_FOUND",errorStatus:404}),this.apiClient=new i(e)}featureFlagConfigListing(e){return n(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:l,data:e||{}});return r.error?(console.warn("Error fetching featureFlagConfigListing due to: [",r.error,"]"),Promise.reject(r.error)):r.data||{count:0,data:[]}}catch(e){return console.warn("Error fetching featureFlagConfigListing due to: [",e,"]"),Promise.reject(e)}}))}allFeatureFlagsConfig(){return n(this,void 0,void 0,(function*(){try{let e=0;const r=200;let t,o=[];do{t=yield this.featureFlagConfigListing({page:e++,size:r}),o=o.concat(t.data)}while(o.length<t.count);return o}catch(e){throw console.error("Error fetching allFeatureFlagsConfig due to:",e),e}}))}featureFlagConfigByKey(e){return n(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"GET",endpoint:s,params:{key:e}});return r.error?(console.warn("Error fetching featureFlagConfigByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagConfigByKey due to: [",e,"]"),Promise.reject(e)}}))}getFeatureFlagByKey(e){return n(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:d,data:e});return r.error?(console.warn("Error fetching featureFlagValueByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagValueByKey due to: [",e,"]"),Promise.reject(e)}}))}}const g=o.createContext(void 0);var v,f;e.FlagStatusEnum=void 0,(v=e.FlagStatusEnum||(e.FlagStatusEnum={})).ON="ON",v.OFF="OFF",e.FlagValueTypeEnum=void 0,(f=e.FlagValueTypeEnum||(e.FlagValueTypeEnum={})).BOOLEAN="BOOLEAN",f.STRING="STRING",f.LONG="LONG",f.DOUBLE="DOUBLE",e.NumeratorClient=c,e.NumeratorProvider=({children:e,configClient:r,defaultContext:a})=>{const i=(e=>new c({apiKey:e.apiKey,baseUrl:e.baseUrl||"https://service-platform.dev.numerator.io"}))(r),[u,l]=o.useState({}),s=(e,r)=>n(void 0,void 0,void 0,(function*(){return yield i.getFeatureFlagByKey({key:e,context:r})})),d=(e,r,t=void 0,o=!0)=>n(void 0,void 0,void 0,(function*(){var n;try{const r=null!=t?t:o?a:{},i=yield s(e,r);return{key:e,value:null!==(n=i.value.booleanValue)&&void 0!==n&&n,reason:{}}}catch(t){return console.warn("Error fetching flag boolean variation:",t),{key:e,value:r,reason:{}}}})),v=(e,r,t=void 0,o=!0)=>n(void 0,void 0,void 0,(function*(){var n,i;try{const r=null!=t?t:o?a:{},u=yield s(e,r);return{key:e,value:null!==(i=null!==(n=u.value.longValue)&&void 0!==n?n:u.value.doubleValue)&&void 0!==i?i:0,reason:{}}}catch(t){return console.warn("Error fetching flag number variation:",t),{key:e,value:r,reason:{}}}})),f=(e,r,t=void 0,o=!0)=>n(void 0,void 0,void 0,(function*(){var n;try{const r=null!=t?t:o?a:{},i=yield s(e,r);return{key:e,value:null!==(n=i.value.stringValue)&&void 0!==n?n:"",reason:{}}}catch(t){return console.warn("Error fetching flag string variation:",t),{key:e,value:r,reason:{}}}})),y={allFlags:()=>n(void 0,void 0,void 0,(function*(){return yield i.allFeatureFlagsConfig()})),booleanFlagVariation:d,numberFlagVariation:v,stringFlagVariation:f,initFeatureFlag:(e,r)=>{u[e]=r,l(u)},getFeatureFlag:(e,r=void 0,t=!0)=>n(void 0,void 0,void 0,(function*(){const o=u[e];switch(typeof o){case"boolean":return(yield d(e,o,r,t)).value;case"number":return(yield v(e,o,r,t)).value;case"string":return(yield f(e,o,r,t)).value}}))};return t.jsx(g.Provider,{value:y,children:e})},e.useNumeratorContext=()=>{const e=o.useContext(g);if(!e)throw new Error("NumeratorClient must be used within a NumeratorProvider");return e}}));
//# sourceMappingURL=index.js.map
