"use strict";var e=require("axios"),r=require("react/jsx-runtime"),t=require("react");function o(e,r,t,o){return new(t||(t=Promise))((function(n,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function u(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,u)}s((o=o.apply(e,r||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const n=e=>null===e||"object"!=typeof e?e:Array.isArray(e)?e.map(n):Object.keys(e).reduce(((r,t)=>(r[t.replace(/_([a-z])/g,((e,r)=>r.toUpperCase()))]=n(e[t]),r)),{});class a{constructor(e){this.apiKey=e.apiKey,this.baseUrl=e.baseUrl||"https://service-platform.dev.numerator.io"}request(r){var t,i;return o(this,void 0,void 0,(function*(){const o=`${this.baseUrl}/${r.endpoint}`,u={"Content-Type":"application/json",[a.API_KEY_HEADER]:this.apiKey},s=Object.assign({url:o,headers:u},r);try{const r=yield e.request(s);return{data:n(r.data),error:void 0}}catch(e){const r=e.response;if(r){return{data:void 0,error:{message:(null===(t=r.data)||void 0===t?void 0:t.message)||"Unknown Error",errorCode:(null===(i=r.data)||void 0===i?void 0:i.error_code)||"unknown_error",errorStatus:r.status}}}return console.warn("AxiosError:",e.message),{data:void 0,error:{message:"Unknown Error",error_code:"unknown_error",http_status:500}}}}))}}a.API_KEY_HEADER="X-NUM-API-KEY";const i="api/sdk/feature-flag",u=`${i}/listing`,s=`${i}/detail-by-key`,l=`${i}/by-key`;class d{constructor(e){this.handleFeatureFlagNotFound=()=>Promise.reject({message:"Feature Flag not found",errorCode:"FEATURE_FLAG_NOT_FOUND",errorStatus:404}),this.apiClient=new a(e)}featureFlagConfigListing(e){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:u,data:e||{}});return r.error?(console.warn("Error fetching featureFlagConfigListing due to: [",r.error,"]"),Promise.reject(r.error)):r.data||{count:0,data:[]}}catch(e){return console.warn("Error fetching featureFlagConfigListing due to: [",e,"]"),Promise.reject(e)}}))}allFeatureFlagsConfig(){return o(this,void 0,void 0,(function*(){try{let e=0;const r=200;let t,o=[];do{t=yield this.featureFlagConfigListing({page:e++,size:r}),o=o.concat(t.data)}while(o.length<t.count);return o}catch(e){throw console.error("Error fetching allFeatureFlagsConfig due to:",e),e}}))}featureFlagConfigByKey(e){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"GET",endpoint:s,params:{key:e}});return r.error?(console.warn("Error fetching featureFlagConfigByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagConfigByKey due to: [",e,"]"),Promise.reject(e)}}))}getFeatureFlagByKey(e){return o(this,void 0,void 0,(function*(){try{const r=yield this.apiClient.request({method:"POST",endpoint:l,data:e});return r.error?(console.warn("Error fetching featureFlagValueByKey due to: [",r.error,"]"),Promise.reject(r.error)):r.data?r.data:this.handleFeatureFlagNotFound()}catch(e){return console.warn("Error fetching featureFlagValueByKey due to: [",e,"]"),Promise.reject(e)}}))}}const c=t.createContext(void 0);var v,g;exports.FlagStatusEnum=void 0,(v=exports.FlagStatusEnum||(exports.FlagStatusEnum={})).ON="ON",v.OFF="OFF",exports.FlagValueTypeEnum=void 0,(g=exports.FlagValueTypeEnum||(exports.FlagValueTypeEnum={})).BOOLEAN="BOOLEAN",g.STRING="STRING",g.LONG="LONG",g.DOUBLE="DOUBLE",exports.NumeratorClient=d,exports.NumeratorProvider=({children:e,configClient:n,defaultContext:a})=>{const i=(e=>new d({apiKey:e.apiKey,baseUrl:e.baseUrl||"https://service-platform.dev.numerator.io"}))(n),[u,s]=t.useState({}),l=(e,r)=>o(void 0,void 0,void 0,(function*(){return yield i.getFeatureFlagByKey({key:e,context:r})})),v=(e,r,t=void 0,n=!0)=>o(void 0,void 0,void 0,(function*(){var o;try{const r=null!=t?t:n?a:{},i=yield l(e,r);return{key:e,value:null!==(o=i.value.booleanValue)&&void 0!==o&&o,reason:{}}}catch(t){return console.warn("Error fetching flag boolean variation:",t),{key:e,value:r,reason:{}}}})),g=(e,r,t=void 0,n=!0)=>o(void 0,void 0,void 0,(function*(){var o,i;try{const r=null!=t?t:n?a:{},u=yield l(e,r);return{key:e,value:null!==(i=null!==(o=u.value.longValue)&&void 0!==o?o:u.value.doubleValue)&&void 0!==i?i:0,reason:{}}}catch(t){return console.warn("Error fetching flag number variation:",t),{key:e,value:r,reason:{}}}})),y=(e,r,t=void 0,n=!0)=>o(void 0,void 0,void 0,(function*(){var o;try{const r=null!=t?t:n?a:{},i=yield l(e,r);return{key:e,value:null!==(o=i.value.stringValue)&&void 0!==o?o:"",reason:{}}}catch(t){return console.warn("Error fetching flag string variation:",t),{key:e,value:r,reason:{}}}})),f={allFlags:()=>o(void 0,void 0,void 0,(function*(){return yield i.allFeatureFlagsConfig()})),booleanFlagVariation:v,numberFlagVariation:g,stringFlagVariation:y,initFeatureFlag:(e,r)=>{u[e]=r,s(u)},getFeatureFlag:(e,r=void 0,t=!0)=>o(void 0,void 0,void 0,(function*(){const o=u[e];switch(typeof o){case"boolean":return(yield v(e,o,r,t)).value;case"number":return(yield g(e,o,r,t)).value;case"string":return(yield y(e,o,r,t)).value}}))};return r.jsx(c.Provider,{value:f,children:e})},exports.useNumeratorContext=()=>{const e=t.useContext(c);if(!e)throw new Error("NumeratorClient must be used within a NumeratorProvider");return e};
//# sourceMappingURL=index.cjs.js.map
